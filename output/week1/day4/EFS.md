---

| [⬅️ EBS](./EBS.md) | [📑 Day 4 목차](./README.md) | [🏠 Week 1](../README.md) | [Instance Store ➡️](./Instance-Store.md) |

---

# EFS 완전 정복

## 📌 핵심 목적 (What & Why)

> **한 줄 정의:** EFS는 클라우드 환경에서 가상 머신과 애플리케이션 간의 파일 공유 및 저장을 위한 AWS의 확장성 있는 파일 저장소 서비스입니다.

### 이 서비스가 해결하는 문제
**기존의 문제점:**
- **문제 1:** EC2 인스턴스 간 파일 공유가 어려워 복제 및 동기화 작업이 필요했습니다. 예를 들어, 웹 서버와 데이터베이스 서버 간 파일 전송은 수작업으로 이루어졌고, 실시간 동기화가 불가능했습니다.  
- **문제 2:** 고성능 파일 저장이 필요할 때, EC2 Instance Store의 제한적인 용량과 단일 인스턴스에 의존해야 했으며, 장애 시 데이터 손실 위험이 있었습니다.  
- **문제 3:** 여러 애플리케이션이 동일한 파일 시스템에 접근해야 할 경우, 별도의 NAS 서버를 구축해야 했고, 관리 및 확장이 복잡했습니다.  

**EFS로 해결:**
- **해결 1:** EFS는 클라우드 내에서 여러 EC2 인스턴스가 동일한 파일 시스템에 접근할 수 있도록 하여, 실시간 공유 및 동기화를 지원합니다.  
- **해결 2:** 고성능과 확장성을 제공하며, 인스턴스 장애 시 데이터를 복제된 위치에서 접근할 수 있어 데이터 손실을 방지합니다.  
- **해결 3:** 단일 파일 시스템을 통해 여러 애플리케이션에 공유 가능하며, 자동 스케일링으로 사용자 증가에 유연하게 대응합니다.  

### 비유로 이해하기
EFS는 사무실의 공유 네트워크 드라이브를 생각해보세요. 모든 직원이 같은 문서를 실시간으로 수정하고, 데이터를 공유할 수 있습니다. 클라우드에 있는 EFS는 이 드라이브를 인터넷을 통해 접근해, 어디서나 데이터를 사용할 수 있도록 해줍니다.  

---

## 🎯 주요 사용 시나리오 (When to Use)

| 시나리오 | 설명 | 구체적 예시 |
|---------|------|-----------|
| 시나리오 1 | 웹 애플리케이션에서 로그 파일 또는 공유 데이터 저장 | AWS에서 실행되는 웹 서버와 백엔드 서버가 동일한 파일 시스템을 공유 |
| 시나리오 2 | 분산 데이터 분석 작업에 대용량 파일 공유 | 여러 EC2 인스턴스가 대규모 데이터셋을 동시에 접근하여 분석 수행 |
| 시나리오 3 | 협업 환경에서 실시간 문서 공유 | 개발 팀이 클라우드 기반 파일 시스템을 통해 코드 및 문서를 실시간으로 수정 |

**이럴 때 EFS를 선택하세요:**
- ✅ **다양한 EC2 인스턴스 간 파일 공유가 필요할 때**  
- ✅ **고성능 및 확장성 요구가 높은 시스템에서**  
- ✅ **실시간 데이터 동기화 및 접근이 필수적인 경우**  

**이럴 때는 다른 서비스를 고려하세요:**
- ❌ **개별 파일 저장이 필요할 때 → S3** (객체 저장소로, 파일별 접근 가능)  
- ❌ **고성능 블록 스토리지가 필요한 경우 → EBS** (Block Storage로, EC2 인스턴스와 직접 연결)  
- ❌ **단일 인스턴스에서 고정 용량의 스토리지가 필요한 경우 → Instance Store** (단일 인스턴스에만 연결됨)  

---

## 🔗 연관 서비스 (Used Together With)

| 연관 서비스 | 연동 목적 | 일반적인 아키텍처 |
|------------|---------|-----------------|
| **Security Groups** | EFS 접근 제어 및 보안 정책 설정 | EFS → Security Groups → EC2 인스턴스 |
| **EC2** | EFS 파일 시스템을 사용하는 인스턴스 | EC2 → EFS → 애플리케이션 |
| **S3** | EFS와 함께 대용량 데이터 저장소로 사용 | EFS → S3 (데이터 백업 및 아카이브) |

**자주 사용되는 아키텍처 패턴:**
```
[사용자] → [CloudFront] → [EC2] → [EFS] → [S3]
```

---

## 💰 비용 구조 (Pricing)

| 과금 항목 | 요금 | 프리티어 |
|----------|-----|---------|
| **Storage Capacity** | $0.10/GB/월 (기본) | 월 100GB 무료 |
| **Data Transfer** | $0.02/GB (간접 트래픽) | 12개월 무료 |
| **Throughput** | $0.10/GB (초과 전송) | 항상 무료 |

**비용 최적화 팁:**
1. 💡 **프리티어 활용:** 100GB까지 무료로 사용 가능하므로, 초기 테스트용으로 적합합니다.  
2. 💡 **데이터 전송 최소화:** S3와 EFS 간 데이터 전송을 줄여 비용 절감.  
3. 💡 **스토리지 클래스 선택:** 사용 패턴에 맞는 스토리지 클래스(예: Infrequent Access)로 전환.  

> **⚠️ 비용 주의:** 데이터 전송 비용이 예상치 않게 증가할 수 있으므로, 트래픽 모니터링과 통계 분석이 필요합니다.

## 📚 핵심 개념

### 개념 1: **EFS 파일 시스템 구성 및 특징**
EFS는 AWS에서 제공하는 **확장성과 가용성이 뛰어난 클라우드 기반 파일 저장소**입니다. EC2 인스턴스나 다른 AWS 서비스에 파일을 공유하고, 대규모 데이터 저장 및 접근이 필요한 경우에 사용됩니다. EFS는 **NFSv4.1 프로토콜**을 기반으로 작동하며, 파일 시스템을 생성하고, 접근 포인트를 관리하며, 네트워크 기반의 파일 저장소로 설계되었습니다.  

#### 왜 중요한가?
- **확장성**: 파일 시스템 크기를 동적으로 조절할 수 있어 데이터 성장에 대응합니다.  
- **다중 인스턴스 접근**: 여러 EC2 인스턴스나 가상 머신에서 동일한 파일 시스템을 공유할 수 있어 협업 효율성을 높입니다.  
- **고가용성**: AWS의 글로벌 인프라를 기반으로 하여 장애 시도중복성 확보가 가능합니다.  

#### 세부 요소
| 요소 | 설명 | 예시 |
|-----|-----|-----|
| **파일 시스템 생성** | EFS에서 파일 시스템을 생성하고, 스토리지 용량을 설정합니다. | `aws efs create-file-system --creation-token my-efs` |
| **접근 포인트** | 특정 파일 시스템에 접근하는 경로를 정의합니다. | `efs://my-efs/accesspoint1` |
| **성능 모드** | **General Purpose** 또는 **Max I/O** 모드로 성능을 조절합니다. | `aws efs create-file-system --performance-mode maxio` |

> **💡 Tip:** EFS는 **NFSv4.1** 기반으로 작동하므로, EC2 인스턴스에서 NFS 클라이언트를 설치해야 합니다. 예를 들어, `sudo apt install nfs-common` 명령어로 설치할 수 있습니다.

---

### 개념 2: **EFS의 가용성 및 확장성**
EFS는 **AWS 글로벌 인프라스트럭처**에 기반하여 **다중 지역(Availability Zone)**에 배포되며, 자동으로 데이터를 복제하여 장애 시도중복성 확보합니다. 이는 **24/7 가용성**을 보장하며, 대규모 데이터 처리 시 **성능 향상**과 **비용 최적화**를 가능하게 합니다.  

#### 작동 원리
1. **파일 시스템 생성 시** AWS는 기본적으로 **2개의 Availability Zone**에 데이터를 복제합니다.  
2. **데이터 접근 시** 클라이언트는 최적의 Zone에서 데이터를 가져옵니다.  
3. **확장 요청 시** EFS는 자동으로 스토리지 용량을 증가시키고, 네트워크 기반으로 데이터를 동기화합니다.  

> **💡 Tip:** EFS의 **Max I/O 모드**는 고성능 작업(예: 백업, 대규모 데이터 처리)에 적합하며, **General Purpose 모드**는 일상적인 파일 저장에 추천됩니다.

---

### 개념 3: **EFS vs EBS/Instance Store 비교**
EFS는 파일 기반 저장소로, EBS(블록 스토리지)와 Instance Store(직접 부착 스토리지)와는 **구조적 차이**가 있습니다.  

#### 주요 특징
1. **** **EFS**:  
   - **네트워크 기반**: 여러 인스턴스에서 공유 가능.  
   - **확장성**: 용량을 동적으로 조절할 수 있음.  
   - **비용**: 스토리지 사용량에 따라 요금이 부과됨.  

2. **EBS**:  
   - **블록 기반**: EC2 인스턴스에 직접 부착됨.  
   - **확장성**: 볼륨 크기 조절 가능하지만, 인스턴스에 종속적임.  
   - **비용**: 볼륨 크기와 I/O 작업 수에 따라 요금이 부과됨.  

3. **Instance Store**:  
   - **지속성**: 인스턴스 종료 시 데이터가 사라짐.  
   - **성능**: 고성능이 필요할 때 사용.  
   - **비용**: 저장소 크기와 인스턴스 유형에 따라 요금이 부과됨.  

> **⚠️ 주의:** Instance Store는 **지속성**이 없으므로, 데이터 백업이 필수적입니다. EFS는 **고가용성**을 제공하지만, **비용 관리**가 필요합니다.

## 🖥️ AWS 콘솔에서 EFS 사용하기

### Step 1: EFS 서비스 접속  
1. AWS Management Console에 로그인합니다  
   - URL: https://console.aws.amazon.com  
2. 상단 검색창에서 **"EFS"**를 입력하고, 검색 결과에서 **"EFS"** 서비스를 클릭합니다  
3. **"EFS"** 대시보드로 이동하면, 파일 시스템 목록과 관리 메뉴가 표시됩니다  

> **📸 화면 확인:** EFS 대시보드에서 "Create file system" 버튼이 보이고, 파일 시스템 목록이 표시되면 정상입니다  

---

### Step 2: [주요 작업 1 - 리소스 생성]  
1. **"Create file system"** 버튼 클릭  
   - **"Create file system"** 메뉴에서 파일 시스템 이름, 스토리지 클래스, 네트워크 설정을 입력합니다  
   - **"Storage class"**에서 **"Standard"** 또는 **"Infrequent Access"**를 선택합니다 (비용에 따라 달라짐)  
2. **"Network settings"** 구성  
   - **"VPC"**를 선택하고, **"Subnets"**를 지정합니다 (필요 시 **"Security groups"**를 설정합니다)  
   - **"DNS name"**을 생성하고, **"Mount target"** 위치를 설정합니다  
3. **"Tags"** 추가 (선택 사항)  
   - 키/값 쌍으로 리소스를 식별할 수 있도록 태그를 추가합니다 (예: `Project: DevOps`, `Environment: Prod`)  

> **📸 화면 확인:** "Create file system" 폼이 열리고, 네트워크 설정 및 태그 입력창이 표시되면 정상입니다  

---

### Step 3: [주요 작업 2 - 설정/구성]  
1. **"Access points"** 생성 (선택 사항)  
   - 특정 사용자/그룹만 접근할 수 있도록 **"Access point"**를 설정합니다 (예: `sudo` 권한 제한)  
2. **"Security groups"** 구성  
   - **"Security groups"**를 설정해 EFS 파일 시스템에 접근할 수 있는 IP 또는 EC2 인스턴스를 제어합니다  
   - **"Inbound rules"**에 **"TCP" 2049** 포트를 허용해야 합니다  
3. **"Lifecycle policies"** 설정 (선택 사항)  
   - 데이터를 스토리지 클래스에 자동 이동하거나 삭제하는 정책을 설정합니다 (비용 최적화 목적)  

> **⚠️ 주의:** 보안 그룹 설정 시, **"TCP 2049"** 포트를 반드시 허용해야 EC2 인스턴스에서 EFS를 마운트할 수 있습니다  

---

### Step 4: 설정 확인 및 테스트  
1. **생성된 리소스 확인 방법**  
   - EFS 대시보드에서 "File systems" 섹션으로 이동해 생성된 파일 시스템 이름과 상태를 확인합니다  
   - **"Mount targets"**가 생성되었는지 확인합니다 (EC2 인스턴스에 마운트용 IP가 표시됨)  
2. **상태 확인 방법**  
   - **"Status"** 섹션에서 **"ACTIVE"** 상태인지 확인합니다  
   - **"Performance"** 섹션에서 IOPS 및 데이터 전송량을 모니터링합니다  
3. **정상 동작 테스트 방법**  
   - EC2 인스턴스에 EFS를 마운트해 파일 읽기/쓰기 테스트를 수행합니다  
   - CLI 명령어:  
     ```bash
     sudo mount -t nfs <EFS_DNS_NAME>:/ <MOUNT_POINT>
     ```
     - 예: `sudo mount -t nfs fs-12345678.efs.us-west-2.amazonaws.com:/ /mnt/efs`

> **📸 화면 확인:** EC2 인스턴스에서 `df -h` 명령어로 마운트된 EFS가 목록에 표시되고, 파일 생성/읽기 테스트가 성공하면 정상입니다  

---

### 🔧 실무 팁  
- **EFS는 다수의 EC2 인스턴스에서 동시에 접근 가능**하지만, **성능 제한**이 있으므로 대규모 데이터 처리 시 **S3 + Lambda** 조합을 고려하세요  
- **프리티어 사용 시** EFS는 **10GB 용량, 10GB/월 데이터 전송량**까지 무료로 제공됩니다  
- **비용 최적화**를 위해 **"Infrequent Access"** 스토리지 클래스를 사용하고, **Lifecycle policies**로 데이터 이동을 자동화하세요

## ⌨️ AWS CLI로 EFS 사용하기

### 사전 준비
```bash
# AWS CLI 버전 확인
aws --version

# AWS 자격 증명 확인
aws sts get-caller-identity

# 현재 리전 확인
aws configure get region
```

**설명:**  
AWS CLI를 사용하기 전에 버전 확인, 자격 증명 유효성 검증, 리전 설정이 필수적입니다. EFS CLI 명령어는 `aws efs` 명령어로 시작됩니다.  
> **💡 Tip:** CLI 환경 변수가 설정되지 않았다면 `aws configure` 명령어로 기본 설정을 완료하세요.

---

### 예제 1: EFS 리소스 조회
```bash
# EFS 파일 시스템 목록 조회
aws efs describe-file-systems \
    --query 'FileSystems[*].{FileSystemId:FileSystemId, Name:Name, LifecyclePolicies:LifecyclePolicies}' \
    --output table
```

**옵션 설명:**
| 옵션 | 설명 | 예시 값 |
|-----|------|---|
| `--query` | 필터링 및 형식 설정 | `'FileSystems[*].{FileSystemId:FileSystemId, Name:Name, LifecyclePolicies:LifecyclePolicies}'` |
| `--output` | 출력 형식 | `table`, `json`, `text` |

**예상 출력:**
```
| FileSystemId | Name      | LifecyclePolicies                 |
|--------------|-----------|------------------------------------|
| fs-12345678  | MyEFS     | [{"Policy": "delete", "TransitionToIA": "30 days"}] |
```

> **⚠️ 주의:** `--query` 파라미터는 AWS CLI 1.16.180 이상에서 지원됩니다.

---

### 예제 2: EFS 리소스 생성
```bash
# EFS 파일 시스템 생성
aws efs create-file-system \
    --name "MyEFS" \
    --creation-token "my-efs-creation-token" \
    --tags "Key=Environment,Value=Production"
```

**필수 옵션:**
- `--name`: 파일 시스템 이름 (유니크한 이름 필요)
- `--creation-token`: 생성 토큰 (중복 방지용, 랜덤 문자열 권장)
- `--tags`: 태그 추가 (선택적)

**예상 출력:**
```json
{
    "FileSystemId": "fs-12345678",
    "OwnerId": "123456789012",
    "CreationToken": "my-efs-creation-token",
    "LifeCyclePolicies": []
}
```

**비용 주의사항:**  
- 기본적으로 EFS는 `standard` 스토리지 클래스 사용  
- `--throughput-mode` 파라미터로 `bursting` 또는 `provisioned` 설정 가능 (비용 차이 있음)

---

### 예제 3: EFS 리소스 수정
```bash
# EFS 파일 시스템 태그 수정
aws efs update-tags \
    --file-system-id "fs-12345678" \
    --tags "Key=Environment,Value=Production,Key=Owner,Value=DevOps"
```

**제한 사항:**  
- EFS CLI는 파일 시스템 생성 시 태그만 수정 가능  
- `--tags` 파라미터는 `Key=Value` 형식으로 전달해야 함  
- 기존 태그는 덮어쓰기 되므로 주의 필요

**예상 출력:**
```json
{
    "FileSystemId": "fs-12345678",
    "Tags": [
        {"Key": "Environment", "Value": "Production"},
        {"Key": "Owner", "Value": "DevOps"}
    ]
}
```

---

### 예제 4: EFS 리소스 삭제
```bash
# EFS 파일 시스템 삭제
aws efs delete-file-system --file-system-id "fs-12345678"

# 삭제 확인 (에러 발생)
aws efs describe-file-systems --file-system-id "fs-12345678"
```

**삭제 후 출력 예시:**
```
An error occurred (FileSystemNotFound) when calling the DescribeFileSystems operation: The file system ID 'fs-12345678' does not exist.
```

> **⚠️ 주의:** 삭제는 즉시 완료되며, 복구 불가능합니다. 삭제 전 `--region` 및 `--file-system-id` 정확성 확인 필수.

---

### 자주 사용하는 명령어 정리
```bash
# 조회
aws efs describe-file-systems --file-system-id "fs-id"
aws efs describe-mount-targets --file-system-id "fs-id"

# 생성
aws efs create-file-system --name "my-efs" --creation-token "token"

# 수정 (태그)
aws efs update-tags --file-system-id "fs-id" --tags "Key=Env,Value=Prod"

# 삭제
aws efs delete-file-system --file-system-id "fs-id"
```

**CLI 프리티어 활용:**  
- EFS는 1년간 $0.02/GB/월 제공 (10GB 기준 1년 $2)  
- `--throughput-mode bursting` 사용 시 비용 최적화 가능  
- `--azs` 파라미터로 특정 AZ에만 배포 가능 (비용 증가)  

> **💡 Tip:** CLI 명령어는 `aws efs help`로 전체 명령어 목록 확인 가능.

## 🎯 SAA-C03 시험 핵심 포인트

### 시험에서 자주 출제되는 EFS 포인트

#### 📌 핵심 출제 포인트 TOP 5
1. **포인트 1: EFS의 주요 용도와 장점**  
   - 설명: EFS는 **NAS(네트워크 첨부 저장소)** 기반의 클라우드 스토리지로, **다중 EC2 인스턴스 간 실시간 파일 공유**가 필요할 때 필수적입니다. 시험에서 EFS의 **고가용성, 확장성, 네트워크 기반 접근성**이 주요 포인트로 자주 출제됩니다.  
   - 키워드: `NAS`, `고가용성`, `다중 인스턴스 공유`

2. **포인트 2: EFS vs S3의 차이점**  
   - 설명: EFS는 파일 시스템 형식으로 **실시간 파일 접근**이 가능하지만, S3는 객체 저장소로 **대량의 비구조화 데이터 저장**에 적합합니다. 시험에서는 **파일 형식 vs 객체 형식**, **접근 방식**, **비용 구조**의 차이가 주요 시험 항목입니다.  
   - 키워드: `파일 시스템`, `객체 저장소`, `접근 방식`

3. **포인트 3: EFS의 확장성과 제한 사항**  
   - 설명: EFS는 **최대 100TB 용량**까지 확장 가능하지만, **서버리스 스토리지**로 **사용자 수 제한**이 없습니다. 그러나 **네트워크 지연**과 **비용 증가**가 주요 단점으로, 시험에서는 이 두 가지가 반드시 기억해야 합니다.  
   - 키워드: `확장성`, `네트워크 지연`, `비용 증가`

4. **포인트 4: EFS의 보안 및 접근 제어**  
   - 설명: EFS는 **IAM 정책**과 **VPC 설정**을 통해 보안을 강화합니다. 시험에서는 **VPC 내외 접근 제어**, **프로토콜( NFSv4.1)**, **네트워크 보안 그룹** 설정이 주요 출제 항목입니다.  
   - 키워드: `IAM 정책`, `VPC`, `NFSv4.1`

5. **포인트 5: EFS의 비용 구조와 프리티어**  
   - 설명: EFS는 **기본 비용(10GB 기준 $0.10/GB)**과 **데이터 전송 비용**이 핵심입니다. 시험에서는 **프리티어 사용 시 제한(10GB)**과 **비용 최적화 전략**이 필수적으로 다루어집니다.  
   - 키워드: `프리티어`, `데이터 전송 비용`, `비용 최적화`

#### ⚠️ 시험에서 자주 나오는 함정
| 함정 유형 | 설명 | 올바른 답변 |
|----------|------|------------|
| 함정 1 | "EFS는 객체 저장소로 사용된다"는 문장에서 오해 | EFS는 **파일 시스템**이지 객체 저장소가 아님. S3와 혼동하지 않기 |
| 함정 2 | "EFS는 EC2 인스턴스에 첨부된 스토리지"라는 설명 | EFS는 **네트워크 기반**이지 디스크 첨부가 아님. EBS와 혼동하지 않기 |
| 함정 3 | "EFS는 데이터 복제가 불가능하다"는 오류 | EFS는 **자동 복제 기능**을 지원하며, 다중 AZ 배포가 가능 |

#### 🔄 EFS vs 비슷한 서비스 비교 (시험 단골!)
| 비교 항목 | EFS | 대안 서비스 | 선택 기준 |
|----------|----------|-----------|----------|
| **용도** | 실시간 파일 공유, 다중 인스턴스 접근 | S3(객체 저장), EBS(볼륨 저장) | **파일 시스템 필요 시** |
| **확장성** | 최대 100TB, 서버리스 확장 | EBS(볼륨 제한), Instance Store(서버 기반) | **확장성 요구 시** |
| **비용** | 기준 0.10달러/GB + 데이터 전송 비용 | S3(객체 저장 비용), EBS(볼륨 비용) | **데이터 전송 비용에 주의** |
| **지연시간** | 네트워크 지연 발생 | EBS(저지연), Instance Store(저지연) | **실시간 처리 시 EFS 사용 금지** |

#### 📝 시험 대비 체크리스트
- [ ] EFS의 핵심 목적을 한 문장으로 설명할 수 있는가?  
  → **다중 EC2 인스턴스 간 실시간 파일 공유에 최적화된 네트워크 기반 스토리지**
- [ ] EFS를 선택해야 하는 시나리오를 알고 있는가?  
  → **협업 환경, 실시간 데이터 공유, 다중 인스턴스 접근 필요 시**
- [ ] EFS의 제한사항/한계를 알고 있는가?  
  → **최대 100TB, 네트워크 지연, 데이터 전송 비용 증가**
- [ ] EFS와 비슷한 서비스의 차이점을 설명할 수 있는가?  
  → **S3는 객체 저장, EBS는 볼륨 저장, EFS는 파일 시스템**
- [ ] EFS의 비용 구조를 이해하고 있는가?  
  → **기준 비용 + 데이터 전송 비용, 프리티어 10GB 제한**

#### 💡 시험 팁
> **키워드 매칭:** 문제에서 이런 키워드가 나오면 EFS를 떠올리세요:  
> - **NAS(네트워크 첨부 저장소)**  
> - **다중 인스턴스 공유**  
> - **실시간 파일 접근**  
> - **네트워크 지연**  
> - **고가용성 스토리지**

---

| [⬅️ EBS](./EBS.md) | [📑 Day 4 목차](./README.md) | [🏠 Week 1](../README.md) | [Instance Store ➡️](./Instance-Store.md) |

---
